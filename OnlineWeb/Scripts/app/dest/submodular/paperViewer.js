define(["util","scroller","echeck","colorpicker"],function(t,e){"use strict";function o(){var e,o,r=$("#scoring-item"),n=t.docCookies,s=1;if(n.hasItem("scale")){var l=parseFloat(n.getItem("scale"));s=l}else{var u=c.width();_.each(i,function(t,e,o){var n=r.width();n>u&&(s=a(n))})}e=new EasyScroller(r.get(0),{zooming:!0,animation:!1,defaultZoom:s}),o=e.scroller;var f=_.throttle(function(t){var e=t.target.tagName.toLowerCase();if("input"!==e)switch(t.code){case"ArrowUp":o.scrollBy(0,-150,!0);break;case"ArrowDown":o.scrollBy(0,150,!0);break;case"ArrowLeft":o.scrollBy(-150,0,!0);break;case"ArrowRight":o.scrollBy(150,0,!0);break;case"NumpadAdd":o.zoomBy(1.2,!0);break;case"NumpadSubtract":o.zoomBy(.8,!0)}},400);if(document.addEventListener("keydown",f),n.hasItem("tool")){var m=n.getItem("tool");"open"===m&&$("#cd-stretchy-nav").addClass("nav-is-visible")}var d=$("#cd-stretchy-nav");return d.on("click",".cd-nav-trigger",function(t){t.preventDefault(),d.hasClass("nav-is-visible")===!0?n.setItem("tool","close"):n.setItem("tool","open"),d.toggleClass("nav-is-visible")}).on("click","#btn-magnify",function(){o.zoomBy(1.2,!0)}).on("click","#btn-shrink",function(){o.zoomBy(.8,!0)}).on("click","#btn-normal",function(){o.zoomTo(1,!0)}).on("click","#btn-fullscreen",function(){o.zoomTo(a(r.width()),!0)}).on("click","#btn-restore",function(){if(n.hasItem("scale")){var t=parseFloat(n.getItem("scale"));o.zoomTo(t,!0)}else o.zoomTo(1,!0)}).on("click","#btn-save",function(){var e=o.getValues();n.setItem("scale",e.zoom.toFixed(2)),t.showInfo("保存图片比例成功")}),$("#form-scoring").find(".form-control").on("focus",function(){var t=$(this).parents(".form-group"),e=function(t){var e=t.split(",");return _.map(e,function(t){return parseFloat($.trim(t))})}(t.data("axis"));if(e&&4===e.length){var n,a=document.getElementById("scoring-item");if(a.getContext){n=a.getContext("2d"),r.data("hasRect")&&n.clearRect(0,0,a.width,a.height),r.data("hasRect",!0),n.strokeStyle="#FF0008",n.lineWidth=2,n.strokeRect.apply(n,e);var i=o.getValues().zoom,s=e[0]*i,l=e[1]*i,u=function(){var t=e[2]*i/2,o=c.width()/2;return o>=t?o-t:t}(),f=function(){var t=e[3]*i/2,o=c.height()/2;return o>=t?o-t:t}(),m={};s>u?m.left=s-u:m.left=0,l>f?m.top=l-f:m.top=0,o.scrollTo(s,m.top,!0)}}}).filter(":first").focus(),e}function r(){$("#form-scoring [name=score]").keyup(n).change(n);var e,o=$("#color-picker");o.tinycolorpicker(),e=o.data("plugin_tinycolorpicker"),o.on("change",function(){var o=e.colorHex;if(o){var r=$("#cd-stretchy-nav");$("#img-wrapper").css("background-color",o),t.docCookies.setItem("background",o),"#FFFFFF"===o?r.removeClass("inverse"):r.addClass("inverse")}}),t.docCookies.hasItem("background")&&(e.setColor(t.docCookies.getItem("background")||"#fff"),o.trigger("change"))}function n(){var t=$("#calculate"),e=$("#score-calculate",t),o=$('#form-scoring [name="score"]'),r=[],n=0;o.each(function(t,e){var o=$(this).val();if(o.length&&s.test(o)){var a=parseFloat(o);-1!==a.toString().indexOf(".")&&(a=parseFloat(a.toFixed(1))),r.push(a),n+=a}}),n=n.toFixed(1),r.length>1?e.text(r.join("+")+"="+n):1===r.length?e.text(r[0]):e.text(""),t.show()}function a(t){var e=c.width();return e/t}var c=$("#img-wrapper"),i=c.find("img"),s=/^-?(\d+\.\d{1,1}|\d+)$/,l={scoreLimit:{func:function(t){var e=parseInt(t.val()),o=parseFloat(t.data("max"));return s.test(e)?e>o?(this.errorMsg="本题满分为 <b>"+o+"</b>",!1):!0:(this.errorMsg="请输入正整数或一位小数",!1)}},trimval:{errorMsg:"",func:function(t){return t.val($.trim(t.val())),!0}}};return $(function(){$("#form-scoring").check({rules:l}),t.initScroll($(".right-fixed")),r()}),o});
//# sourceMappingURL=paperViewer.js.map