define(["util"],function(){function t(t,e){this.options=_.extend({throttleNums:10},e),this.initialQuery=t,this.imageQuery=[]}function e(){this.imageQuery=_.map(this.initialQuery,function(t){return{image:i(t.ImageUrl),id:t.TestletsId}}),delete this.initialQuery}function i(t){var e=document.createElement("img");return e.src=t,e}return t.prototype.start=function(){this.initialQuery&&this.initialQuery.length&&e.apply(this),function t(e){if(e.imageQuery.length<e.options.throttleNums){var s=$.Deferred();$.getJSON("/Business/PullTestlets",{id:e.options.testletsId}).done(function(t){if(0===t.Success){var n={image:i(t.Data.ImageUrl),id:t.Data.TestletsId};e.imageQuery.push(n),s.resolve(n)}}).fail(function(){s.reject()}).always(function(){delete e.wait,t(e)}),e.wait=s.promise()}}(this)},t.prototype.getItem=function(t,e){if(this.imageQuery.length){var s=this.imageQuery.shift();e?this.imageQuery.push({image:i(e.ImageUrl),id:e.TestletsId}):this.start(),t(s)}else this.wait&&this.wait.done(function(e){t(e)})},t});
//# sourceMappingURL=cacheQuery.js.map